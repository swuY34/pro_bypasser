import httpx
import time
from typing import *
from seleniumwire import webdriver
from bs4 import BeautifulSoup
from fake_useragent import UserAgent


class FluxusKeyBypasser:
    def __init__(self, hwid: str):
        self.hwid = hwid

    @staticmethod
    def create_driver() -> object:
        ua = UserAgent()
        agent = ua.random
        options = webdriver.ChromeOptions()
        options.add_argument("--headless=new")  # https://www.selenium.dev/blog/2023/headless-is-going-away/
        options.add_argument(f"user-agent={agent}")
        options.add_argument("window-size=1400,600")
        options.add_argument("log-level=3")
        options.add_experimental_option('excludeSwitches', ['enable-logging'])
        driver = webdriver.Chrome(options=options)

        return driver

    @staticmethod
    def get_key(html_content: str) -> Any:
        soup = BeautifulSoup(html_content, 'html.parser')
        code_elements = soup.find_all('code')
        if len(code_elements) > 1:
            return code_elements[1].text.strip()
        return None

    def get_response_content(self) -> Any:
        driver = self.create_driver()

        base_url = f"https://flux.li/windows/start.php?HWID={self.hwid}"

        driver.get(base_url)
        time.sleep(3)
        driver.header_overrides = {'Referer': base_url}

        driver.get(f"{base_url}&7b20bcc1dfe26db966bb84f159da392f=false")

        ua = UserAgent().random

        common_header = {
            'Referer': 'https://linkvertise.com/',
            'User-Agent': ua
        }

        with httpx.Client() as client:
            client.get(base_url, headers={
                'Referer': 'https://fluxteam.net/',
            })

            client.get("https://flux.li/windows/start.php?7b20bcc1dfe26db966bb84f159da392f=false&HWID=" + self.hwid)

            client.get("https://fluxteam.net/windows/checkpoint/check1.php", headers=common_header)
            client.get("https://fluxteam.net/windows/checkpoint/check2.php", headers=common_header)
            response = client.get("https://fluxteam.net/windows/checkpoint/main.php", headers=common_header)

            return response.text

    def main(self) -> str:
        html_content = self.get_response_content()
        fluxus_key = self.get_key(html_content)

        print(fluxus_key)
        return fluxus_key


if __name__ == '__main__':
    flh = input("enter hwid: ")
    fxx = FluxusKeyBypasser(flh)
    fxx.main()
