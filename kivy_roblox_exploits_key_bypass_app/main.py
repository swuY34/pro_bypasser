from kivy.app import App
from kivy.clock import Clock
from kivy.core.window import Window
from kivy.uix.boxlayout import BoxLayout
from kivy.core.clipboard import Clipboard

import os

from utils.fluxus_bypass import fluxus_key_bypasser


os.environ['KIVY_WINDOW'] = 'pygame'


class OriginalBoxLayout(BoxLayout):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        self.fluxus_text_input = None
        self.delta_text_input = None
        self.linkvertise_text_input = None

    ''' getting key part '''
    def on_get_fluxus_key(self, dt):
        if "HWID" in self.fluxus_text_input:
            hwid = self.fluxus_text_input.strip().split('HWID=')[-1]
            fluxus_key_system_bypasser = fluxus_key_bypasser.FluxusKeyBypasser(hwid)
            fluxus_key = fluxus_key_system_bypasser.main()

            self.fluxus_text_input = self.ids["fluxus_text_input"].text = fluxus_key
        else:
            self.ids["fluxus_text_input"].text = "INPUT ERROR"

    ''' get key part '''
    def get_fluxus_key_event(self):
        self.fluxus_text_input: str = self.ids["fluxus_text_input"].text
        self.ids["fluxus_text_input"].text = 'wait for bypass key....'

        Clock.schedule_once(self.on_get_fluxus_key, 0)

    def get_delta_key(self):
        self.delta_text_input = self.ids["delta_text_input"].text = "NO FOUBD"
        print(self.delta_text_input)

    def get_linkvertise_key(self):
        self.linkvertise_text_input = self.ids["linkvertise_text_input"].text = "NO FOUBD"
        print(self.linkvertise_text_input)

    ''' copy text part '''
    def copy_fluxus_key(self):
        Clipboard.copy(self.fluxus_text_input)

    def copy_delta_key(self):
        Clipboard.copy(self.delta_text_input)

    def copy_linkvertise_key(self):
        Clipboard.copy(self.linkvertise_text_input)


class MyApp(App):
    def build(self):
        self.title = "Pro Bypasser"
        
        return OriginalBoxLayout()
    
    def on_start(self):
        # 在应用程序启动时设置窗口大小
        Window.size = (400, 700)

if __name__ == '__main__':
    MyApp().run()
